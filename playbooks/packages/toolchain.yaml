# code: language=ansible
---
- name: Create toolchain
  hosts: "{{ host | default('localhost') }}"
  gather_facts: false
  become: true
  vars_files:
    - ../vars/automated-linux.yaml
  tasks:
    - name: Get TARGET environment variable
      changed_when: false
      ansible.builtin.command: |
        uname -m
      register: arch

    - name: Get TARGET environment variable
      changed_when: false
      ansible.builtin.command: |
        nproc
      register: nproc

    - name: Import binutils tasks
      ansible.builtin.import_tasks: toolchain/binutils.yaml
      vars:
        binutils_version: binutils-2.43.1
        binutils_url: https://ftp.gnu.org/gnu/binutils/binutils-2.43.1.tar.xz

    - name: Import gcc stage1 tasks
      ansible.builtin.import_tasks: toolchain/gcc_stage1.yaml
      vars:
        gcc_version: gcc-14.2.0
        gcc_url: https://ftp.gnu.org/gnu/gcc/gcc-14.2.0/gcc-14.2.0.tar.xz
        mpfr_version: mpfr-4.2.1
        mpfr_url: https://ftp.gnu.org/gnu/mpfr/mpfr-4.2.1.tar.xz
        gmp_version: gmp-6.3.0
        gmp_url: https://ftp.gnu.org/gnu/gmp/gmp-6.3.0.tar.xz
        mpc_version: mpc-1.3.1
        mpc_url: https://ftp.gnu.org/gnu/mpc/mpc-1.3.1.tar.gz

    - name: Import Linux Headers tasks
      ansible.builtin.import_tasks: toolchain/linux_headers.yaml
      vars:
        linux_version: linux-6.12.8
        linux_url: https://www.kernel.org/pub/linux/kernel/v6.x/linux-6.12.8.tar.xz

    - name: Import Glibc tasks
      ansible.builtin.import_tasks: toolchain/glibc.yaml
      vars:
        glibc_version: glibc-2.40
        glibc_url: https://ftp.gnu.org/gnu/glibc/glibc-2.40.tar.xz

    - name: Import Libstdc++ tasks
      ansible.builtin.import_tasks: toolchain/libstdcpp.yaml
      vars:
        gcc_version: gcc-14.2.0
        gcc_url: https://ftp.gnu.org/gnu/gcc/gcc-14.2.0/gcc-14.2.0.tar.xz

    - name: Import m4 tasks
      ansible.builtin.import_tasks: toolchain/m4.yaml
      vars:
        m4_version: m4-1.4.19
        m4_url: https://ftp.gnu.org/gnu/m4/m4-1.4.19.tar.xz

    - name: Import ncurses tasks
      ansible.builtin.import_tasks: toolchain/ncurses.yaml
      vars:
        ncurses_version: ncurses-6.5
        ncurses_url: https://invisible-mirror.net/archives/ncurses/ncurses-6.5.tar.gz

    - name: Import bash tasks
      ansible.builtin.import_tasks: toolchain/bash.yaml
      vars:
        bash_version: bash-5.2.37
        bash_url: https://ftp.gnu.org/gnu/bash/bash-5.2.37.tar.gz

    - name: Import coreutils tasks
      ansible.builtin.import_tasks: toolchain/coreutils.yaml
      vars:
        coreutils_version: coreutils-9.5
        coreutils_url: https://ftp.gnu.org/gnu/coreutils/coreutils-9.5.tar.xz
